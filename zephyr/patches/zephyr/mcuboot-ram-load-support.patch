From 59cd5872d07aa1a75f6bacab85055cbc4cbbd9dc Mon Sep 17 00:00:00 2001
From: Daniel DeGrasse <ddegrasse@tenstorrent.com>
Date: Tue, 24 Jun 2025 20:08:22 -0400
Subject: [PATCH] mcuboot: add RAM load with revert mode

Add in the ram load with revert mode to MCUboot. This mode allows
MCUboot to load an image into RAM and execute it, while also allowing
the image to be marked for test or permanent boot. If the image is
marked for test, it must confirm itself on the first boot, or it will
be reverted to the previously approved application.

Signed-off-by: Daniel DeGrasse <ddegrasse@tenstorrent.com>
---
 share/sysbuild/images/bootloader/Kconfig | 14 ++++++++++++++
 1 file changed, 14 insertions(+)

diff --git a/share/sysbuild/images/bootloader/Kconfig b/share/sysbuild/images/bootloader/Kconfig
index 1b5cdec41ea..c1a9c0a021d 100644
--- a/share/sysbuild/images/bootloader/Kconfig
+++ b/share/sysbuild/images/bootloader/Kconfig
@@ -119,6 +119,20 @@ config MCUBOOT_MODE_RAM_LOAD
 	  Note: RAM must be assigned to the bootloader that is not used by the application in this
 	  mode so that the bootloader is able to function until the application has booted.
 
+config MCUBOOT_MODE_RAM_LOAD_WITH_REVERT
+       bool "RAM load with revert"
+       help
+          MCUboot expects slot0_partition and slot1_partition to exist in DT. In this mode, MCUboot
+          will select the image with the higher version number, copy it to RAM and begin execution
+          from there. MCUBoot will only boot an image if it has been marked to be boot next time
+          for test or permanently. In case when application is marked for test it needs to confirm
+          itself, on the first boot, or it will be removed and MCUboot will revert to booting
+          previously approved application. The image must be linked to execute from RAM, the address
+          that it is copied to is specified using the load-addr argument when running imgtool.
+
+          Note: RAM must be assigned to the bootloader that is not used by the application in this
+          mode so that the bootloader is able to function until the application has booted.
+
 config MCUBOOT_MODE_FIRMWARE_UPDATER
 	bool "Firmware updater"
 	help
-- 
2.34.1

